import org.mybatis.spring.support.SqlSessionDaoSupport;
import org.springframework.stereotype.Repository;
import org.springframework.util.Assert;

import java.util.Date;
import java.util.List;

@Repository
public class ${table.beanName}DAOImpl
    extends SqlSessionDaoSupport
    implements ${table.beanName}DAO {

    @Override
    public List<#if(${config.needDO})${table.beanName}DO#else${table.beanName}#end> query(${table.beanName}Query query) {

        Assert.notNull(query);

        query.decorate();

        return this.getSqlSession().selectList("${table.namespace}.QUERY", query);
    }

    @Override
    public Integer count(${table.beanName}Query query) {

        Assert.notNull(query);

        return this.getSqlSession().selectOne("${table.namespace}.COUNT", query);
    }

    @Override
    public #if(${config.needDO})${table.beanName}DO#else${table.beanName}#end findById(Long id) {

        Assert.notNull(id, "id不能为空");

        return this.getSqlSession().selectOne("${table.namespace}.FIND_BY_ID", id);
    }

    @Override
    public int updateById(#if(${config.needDO})${table.beanName}DO#else${table.beanName}#end updateParam) {

        Assert.notNull(updateParam);
        Assert.notNull(updateParam.getId(), "id不能为空");

        updateParam.setCreateTime(null);
        updateParam.setModifyTime(new Date());

        return this.getSqlSession().update("${table.namespace}.UPDATE_BY_ID", updateParam);
    }

    @Override
    public int insert(#if(${config.needDO})${table.beanName}DO ${table.injectName}DO#else${table.beanName} ${table.injectName}#end) {

        checkParamForInsert(#if(${config.needDO})${table.injectName}DO#else${table.injectName}#end);

        #if(${config.needDO})${table.injectName}DO#else${table.injectName}#end.setCreateTime(new Date());
        #if(${config.needDO})${table.injectName}DO#else${table.injectName}#end.setModifyTime(null);

        return this.getSqlSession().insert("${table.namespace}.INSERT", #if(${config.needDO})${table.injectName}DO#else${table.injectName}#end);
    }

    private void checkParamForInsert(#if(${config.needDO})${table.beanName}DO ${table.injectName}DO#else${table.beanName} ${table.injectName}#end) {
        Assert.notNull(#if(${config.needDO})${table.injectName}DO#else${table.injectName}#end);

        //TODO check code
    }
}